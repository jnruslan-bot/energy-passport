<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>–ü–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –¢–≠–†</title>

  <!-- –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏/—Ä–æ–ª–µ–π -->
  <script type="module" src="guard.js"></script>

  <style>
    body { font-family: Arial, sans-serif; padding: 12px; }

    .topbar { display:flex; gap:10px; flex-wrap:wrap; margin-bottom: 12px; }

    .btn {
      display:inline-block; padding:6px 10px; border:1px solid #999;
      background:#fff; border-radius:6px; cursor:pointer; text-decoration:none; color:#000;
    }
    .btn:hover { background:#f2f2f2; }

    .panel {
      display:flex; gap:10px; flex-wrap:wrap; align-items:center;
      margin: 10px 0 12px;
    }

    input { padding:6px; border:1px solid #bbb; border-radius:6px; }

    .wrap { overflow:auto; border:1px solid #ddd; border-radius:10px; }
    table { border-collapse: collapse; min-width: 1100px; width: 100%; }
    th, td { border: 1px solid #666; padding: 6px; text-align: center; }
    thead th { background:#f5f5f5; }

    .col-no { width: 50px; }
    .col-name { width: 220px; text-align:left; }
    .col-type { width: 230px; text-align:left; }
    .col-unit { width: 110px; }
    .yearCell input { width: 120px; text-align:right; }

    .readonly { background:#f9f9f9; }

    .note { color:#555; font-size: 13px; margin-top: 10px; line-height: 1.35; }

    /* ===== –≥—Ä–∞—Ñ–∏–∫–∏ (–ª–∏–Ω–µ–π–Ω—ã–µ) ===== */
    .chartsWrap { display: flex; flex-direction: column; gap: 16px; margin-top: 10px; }
    .chartSection { border:1px solid #ddd; border-radius: 10px; padding: 10px; }
    .chartTitle { margin: 0 0 10px; font-size: 16px; }
    .chartsGrid { display: grid; grid-template-columns: repeat(3, minmax(280px, 1fr)); gap: 12px; }
    .chartCard { border:1px solid #eee; border-radius: 10px; padding: 10px; }
    .chartCard canvas { width: 100% !important; height: 260px !important; }
    @media (max-width: 1100px) { .chartsGrid { grid-template-columns: 1fr; } }

    /* ===== –ø–æ–¥ –≥—Ä–∞—Ñ–∏–∫–æ–º: —Ç–∞–±–ª–∏—Ü–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–π + –∞–Ω–∞–ª–∏–∑ ===== */
    .deltaBox { margin-top: 10px; }
    .deltaTable { width: 100%; border-collapse: collapse; font-size: 12px; }
    .deltaTable th, .deltaTable td { border: 1px solid #ddd; padding: 6px; text-align: right; }
    .deltaTable th:first-child, .deltaTable td:first-child { text-align: center; }
    .deltaTable th { background: #fafafa; }
    .deltaNote { margin: 8px 0 0; font-size: 12px; color:#444; line-height: 1.35; }
    .deltaUp { color: #0a7; font-weight: 600; }
    .deltaDown { color: #c33; font-weight: 600; }

    /* ===== —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ –≥–æ–¥–∞–º (pie) ===== */
    .yearlyWrap { display: flex; flex-direction: column; gap: 16px; margin-top: 10px; }
    .yearSection { border:1px solid #ddd; border-radius: 10px; padding: 10px; }
    .yearTitle { margin: 0 0 10px; font-size: 16px; }
    .yearGrid { display:grid; grid-template-columns: repeat(2, minmax(320px, 1fr)); gap: 12px; }
    .yearCard { border:1px solid #eee; border-radius: 10px; padding: 10px; }
    .yearCard canvas { width: 100% !important; height: 280px !important; }

    .yearTable { width: 100%; border-collapse: collapse; font-size: 12px; margin-top: 10px; }
    .yearTable th, .yearTable td { border: 1px solid #ddd; padding: 6px; text-align: right; }
    .yearTable th:first-child, .yearTable td:first-child { text-align: left; }
    .yearTable th { background:#fafafa; }
    .yearDesc { margin: 8px 0 0; font-size: 12px; color:#444; line-height: 1.35; }

    @media (max-width: 1100px) {
      .yearGrid { grid-template-columns: 1fr; }
    }

    /* ===== –ø–µ—á–∞—Ç—å/PDF ===== */
    @media print {
      .topbar, .panel { display: none !important; }
      .wrap { border: none; }
      .chartSection, .chartCard, .yearSection, .yearCard { break-inside: avoid; page-break-inside: avoid; }
      * { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
    }
  </style>
</head>

<body>
  <div class="topbar">
    <a class="btn" href="dashboard.html">‚Üê –ù–∞–∑–∞–¥</a>
    <a class="btn" href="index.html">üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
  </div>

  <h1>–ü–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –¢–≠–†</h1>

  <div class="panel">
    <label>–ì–æ–¥—ã —Å:
      <input id="startYear" type="number" value="2022" style="width:90px;">
    </label>

    <label>–ø–æ:
      <input id="endYear" type="number" value="2026" style="width:90px;">
    </label>

    <button class="btn" id="applyYearsBtn" type="button">–ü—Ä–∏–º–µ–Ω–∏—Ç—å –≥–æ–¥—ã</button>
    <button class="btn" id="addTerBtn" type="button">Ôºã –î–æ–±–∞–≤–∏—Ç—å –¢–≠–†</button>
    <button class="btn" id="saveBtn" type="button">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    <button class="btn" id="loadBtn" type="button">‚≠Æ –ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
    <button class="btn" id="clearBtn" type="button">üßπ –û—á–∏—Å—Ç–∏—Ç—å</button>
    <button class="btn" id="downloadPdfBtn" type="button">‚¨áÔ∏è –°–∫–∞—á–∞—Ç—å PDF</button>
    <button class="btn" id="downloadXlsxBtn" type="button">‚¨áÔ∏è –°–∫–∞—á–∞—Ç—å Excel</button>
    <button class="btn" id="downloadChartsPngBtn" type="button">‚¨áÔ∏è –°–∫–∞—á–∞—Ç—å –≥—Ä–∞—Ñ–∏–∫–∏ PNG</button>
  </div>

  <div class="wrap">
    <table id="terTable">
      <thead id="terThead"></thead>
      <tbody id="terTbody"></tbody>
    </table>
  </div>

  <div class="note">
    –¢.—É.—Ç –∏ —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å —Å—á–∏—Ç–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
    <b>—Ç.—É.—Ç = –Ω–∞—Ç—É—Ä–∞–ª—å–Ω–æ–µ √ó –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç</b>,
    <b>—Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å = –¥–µ–Ω—å–≥–∏ / –Ω–∞—Ç—É—Ä–∞–ª—å–Ω–æ–µ</b>.
  </div>

  <h2 style="margin-top:18px;">–ì—Ä–∞—Ñ–∏–∫–∏</h2>
  <div id="chartsWrap" class="chartsWrap"></div>

  <!-- ‚úÖ –ù–æ–≤–∞—è —Å–µ–∫—Ü–∏—è: —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ –≥–æ–¥–∞–º -->
  <h2 style="margin-top:18px;">–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ –≥–æ–¥–∞–º</h2>
  <div class="note">
    –ö—Ä—É–≥–æ–≤—ã–µ –¥–∏–∞–≥—Ä–∞–º–º—ã –ø–æ –∫–∞–∂–¥–æ–º—É –≥–æ–¥—É: —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö —ç–Ω–µ—Ä–≥–æ—Ä–µ—Å—É—Ä—Å–æ–≤
    <b>–≤ —Ç.—É.—Ç</b> –∏ <b>–≤ —Ç–≥.</b>, –ø–ª—é—Å —Å—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –∏ –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ.
  </div>
  <div id="yearlyWrap" class="yearlyWrap"></div>

  <!-- libs -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <!-- PDF -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

  <!-- Excel (.xlsx) -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <!-- logic -->
  <script type="module" src="ter-consumption.js"></script>
</body>
</html>
